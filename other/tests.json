{
    "blocks": [],
    "contracts": [
        {
            "Name": "tests_JsonOperationDB",
            "Value": "contract tests_JsonOperationDB {\n    data{}\n    \n    action {\n        var TABLE string\n        TABLE = \"tests\"\n        var flag map\n        flag[\"insert\"] = \"ok\"\n        var id int\n        id = DBInsert(TABLE, \"json\", flag)\n        \n        flag[\"update\"] = \"ok\"\n        DBUpdate(TABLE, id, \"json\", flag)\n        \n        var found map\n        found = DBFind(TABLE).Where(\"id=? and json->update='ok'\", id).Row()\n        flag[\"found\"] = \"ok\"\n        DBUpdate(TABLE, Int(found[\"id\"]), \"json\", flag)\n        \n        var result map\n        result = DBFind(TABLE).Where(\"id=?\", found[\"id\"]).Row()\n        \n        if result[\"json\"] == `{\"found\": \"ok\", \"insert\": \"ok\", \"update\": \"ok\"}`{\n            $result = true\n        }else{\n            $result = false\n        }\n    }\n}",
            "Conditions": "ContractConditions(\"MainCondition\")"
        },
        {
            "Name": "tests_Run",
            "Value": "contract tests_Run {\n    data{\n        Date string \"date\"\n    }\n    conditions {\n        var tests array\n        tests[0] = \"tests_JsonOperationDB\"\n        $tests = tests\n    }\n    action {\n        var i int\n        while i < Len($tests) {\n            var success bool\n            var params map\n            success = CallContract($tests[i], params)\n            if success {\n                DBInsert(\"tests\", \"name,date,result\", $tests[i], $Date, \"ok\")\n            }else{\n                DBInsert(\"tests\", \"name,date,result\", $tests[i], $Date, \"fail\")\n            }\n            i=i+1\n        }\n        \n    }\n}",
            "Conditions": "ContractConditions(\"MainCondition\")"
        }
    ],
    "data": [],
    "languages": [],
    "menus": [
        {
            "Name": "default_menu",
            "Value": "MenuItem(Title:tests, Page:tests, Icon:\"fa fa-edit\")",
            "Conditions": "ContractAccess(\"@1EditMenu\")"
        }
    ],
    "pages": [
        {
            "Name": "tests",
            "Value": "SetVar(now, Now(\"YYYY-MM-DD HH:MI:SS\"))\nDiv(content-wrapper){\n    Div(row){\n        Div(col-sm-10 col-sm-offset-1 col-lg-8 col-lg-offset-2){\n            Form(panel panel-default){\n                Div(panel-heading text-right){\n                    Button(Body: Run contracts tests, Contract: tests_Run, Class: btn btn-primary, Page: tests, PageParams: \"date=#now#\", Params: \"Date=#now#\")\n                }\n                Div(panel-body){\n                    If(GetVar(date)){\n                        Div(h3){Contract operation tests, DateTime(#date#)}\n                        DBFind(Name: tests, Source: src).Where(\"date='#date#'\").Order(\"id desc\")\n                        ForList(src){\n                            If(#result#==\"fail\"){\n                                SetVar(hl, text-danger)\n                            }.Else{\n                                SetVar(hl, text-success)\n                            }\n                            Div(form-group row #hl#){\n                                Div(col-sm-10){#name#}\n                                Div(col-sm-2){#result#}\n                            }\n                        }\n                    }\n                    Div(h3){Page operation tests, DateTime(#now#)}\n                    Div(form-group row){\n                        Div(col-sm-2 text-center){details}\n                        Div(col-sm-10){\n                            Div(col-sm-10 text-center){case}\n                            Div(col-sm-2){result}\n                        }\n                    }\n                    Div(form-group row){\n                        Div(col-sm-2 text-muted text-center){\n                            If(){\n                                SetVar(t1_fail, text-danger)\n                            }.Else{\n                                SetVar(t1_ok, text-success)\n                            }\n                        }\n                        Div(col-sm-10 #t1_ok# #t1_fail#){\n                            Div(col-sm-10){\"normal If\"}\n                            Div(col-sm-2){\n                                If(GetVar(t1_fail)){fail}.Else{ok}\n                            }\n                        }\n                    }\n                    Div(form-group row){\n                        Div(col-sm-2 text-muted text-center){\n                            SetVar(\"Condition1\", 1).(\"Condition2\", 0.3)\n                            If(And(GetVar(\"Condition2\") == 0.3, And(GetVar(\"Condition1\") == 1, Or(GetVar(\"Condition2\") == 0, GetVar(\"Condition1\") == 0)))){\n                                SetVar(t2_fail, text-danger)\n                            }.Else{\n                                SetVar(t2_ok, text-success)\n                            }\n                        }\n                        Div(col-sm-10 #t2_ok# #t2_fail#){\n                            Div(col-sm-10){\"complex If, And, Or, GetVar with vars\"}\n                            Div(col-sm-2){\n                                If(GetVar(t2_fail)){fail}.Else{ok}\n                            }\n                        }\n                    }\n                    Div(form-group row){\n                        Div(col-sm-2 text-muted text-center){\n                            SetVar(\"Condition1\", 1).(\"Condition2\", 0.3)\n                            If(And(0.3 == 0.3, And(1 == 1, Or(0.3 == 0, 1 == 0)))){\n                                SetVar(t3_fail, text-danger)\n                            }.Else{\n                                SetVar(t3_ok, text-success)\n                            }\n                        }\n                        Div(col-sm-10 #t3_ok# #t3_fail#){\n                            Div(col-sm-10){\"complex If, And, Or, GetVar with values\"}\n                            Div(col-sm-2){\n                                If(GetVar(t3_fail)){fail}.Else{ok}\n                            }\n                        }\n                    }\n                    Div(form-group row){\n                        Div(col-sm-2 text-muted text-center){\n                            SetVar(\"Condition3\", 1)\n                            If(#Condition3# == 2){\n                                1 SetVar(t4_fail, text-danger)\n                            }.ElseIf(#Condition3# == 1){\n                                SetVar(\"Condition3\", 2)\n                                2 SetVar(t4_ok, text-success)\n                            }.ElseIf(#Condition3# == 2){\n                                3 SetVar(t4_fail, text-danger)\n                            }.Else{\n                                else SetVar(t4_fail, text-danger)\n                            }\n                        }\n                        Div(col-sm-10 #t4_ok# #t4_fail#){\n                            Div(col-sm-10){\"a. reset condition If, ElseIf, Else\"}\n                            Div(col-sm-2){\n                                If(GetVar(t4_fail)){fail}.Else{ok}\n                            }\n                        }\n                    }\n                    Div(form-group row){\n                        Div(col-sm-2 text-muted text-center){\n                            SetVar(\"Condition4\", 1)\n                            If(GetVar(Condition4) == 2){\n                                1 SetVar(t5_fail, text-danger)\n                            }.ElseIf(GetVar(Condition4) == 1){\n                                SetVar(\"Condition4\", 2)\n                                2 SetVar(t5_ok, text-success)\n                            }.ElseIf(GetVar(Condition4) == 2){\n                                3 SetVar(t5_fail, text-danger)\n                            }.Else{\n                                else SetVar(t5_fail, text-danger)\n                            }\n                        }\n                        Div(col-sm-10 #t5_ok# #t5_fail#){\n                            Div(col-sm-10){\"b. reset condition If, ElseIf, Else with GetVar\"}\n                            Div(col-sm-2){\n                                If(GetVar(t5_fail)){fail}.Else{ok}\n                            }\n                        }\n                    }\n                    Div(form-group row){\n                        Div(col-sm-2 text-muted text-center){\n                            SetVar(coltype, GetColumnType(members, member_name))\n                            SetVar(colnone, GetColumnType(none, none))\n                            SetVar(colempty, GetColumnType())\n                            If(Or(#coltype#!=\"varchar\",#colnone#>0,#colempty#>0)){\n                                SetVar(t6_fail, text-danger)\n                            }.Else{\n                                SetVar(t6_ok, text-success)\n                            }\n                        }\n                        Div(col-sm-10 #t6_ok# #t6_fail#){\n                            Div(col-sm-10){\"GetColumnType\"}\n                            Div(col-sm-2){\n                                If(GetVar(t6_fail)){fail}.Else{ok}\n                            }\n                        }\n                    }\n                    Div(form-group row){\n                        Div(col-sm-2 text-muted text-center){\n                            DBFind(parameters, src_par).Columns(\"id\").Order(id).Where(\"id >= 1 and id <= 3\").Count(count)\n                            If(#count#==3){\n                                SetVar(t7_ok, text-success)\n                            }.Else{\n                                SetVar(t7_fail, text-danger)\n                            }\n                        }\n                        Div(col-sm-10 #t7_ok# #t7_fail#){\n                            Div(col-sm-10){\nCode(\n    DBFind.Count\n)\n                            }\n                            Div(col-sm-2){\n                                If(GetVar(t7_fail)){fail}.Else{ok}\n                            }\n                        }\n                    }\n                    Div(form-group row){\n                        Div(col-sm-2 text-muted text-center){\n                            SetVar(where)\n                            DBFind(contracts, src).Columns(id).Order(id).Limit(3).Custom(a){SetVar(where, #where# #id#)}\n                            If(#where#==\"1 2 3\"){\n                                SetVar(t8_ok, text-success)\n                            }.Else{\n                                SetVar(t8_fail, text-danger)\n                            }\n                        }\n                        Div(col-sm-10 #t8_ok# #t8_fail#){\n                            Div(col-sm-10){\nCode(\n    DBFind(contracts, src).Columns(id).Order(id).Limit(3).Custom(a){SetVar(where, #where# #id#)}\n)\n                            }\n                            Div(col-sm-2){\n                                If(GetVar(t8_fail)){fail}.Else{ok}\n                            }\n                        }\n                    }\n                    Div(form-group row){\n                        Div(col-sm-2 text-muted text-center){\n                            DBFind(contracts, src).Order(id).Where(\"id=2\").Vars(t9_vars)\n                            If(#t9_vars_id#==2){\n                                SetVar(t9_ok, text-success)\n                            }.Else{\n                                SetVar(t9_fail, text-danger)\n                            }\n                        }\n                        Div(col-sm-10 #t9_ok# #t9_fail#){\n                            Div(col-sm-10){\nCode(\n    DBFind(contracts, src).Order(id).Where(\"id=2\").Vars(t9_vars)\n)\n                            }\n                            Div(col-sm-2){\n                                If(GetVar(t9_fail)){fail}.Else{ok}\n                            }\n                        }\n                    }\n                    Div(form-group row){\n                        Div(col-sm-2 text-muted text-center){\n                            If(#isMobile#==0){\n                                Desktop\n                                SetVar(t10_ok, text-success)\n                            }.Else{\n                                If(#isMobile#==1){\n                                    Mobile\n                                    SetVar(t10_ok, text-success)\n                                }.Else{\n                                    SetVar(t10_fail, text-danger)\n                                }\n                            }\n                        }\n                        Div(col-sm-10 #t10_ok# #t10_fail#){\n                            Div(col-sm-10){\"isMobile\"}\n                            Div(col-sm-2){\n                                If(GetVar(t10_fail)){fail}.Else{ok}\n                            }\n                        }\n                    }\n                    Div(form-group row){\n                        Div(col-sm-2 text-muted text-center){\n                            Range(t11_my,0,5)\n                            SetVar(t11,\"\")\n                            ForList(t11_my){SetVar(t11,#t11# #t11_my_index#=#id#)}\n                            If(#t11#==\"1=0 2=1 3=2 4=3 5=4\"){\n                                SetVar(t11_ok, text-success)\n                            }.Else{\n                                SetVar(t11_fail, text-danger)\n                            }\n                        }\n                        Div(col-sm-10 #t11_ok# #t11_fail#){\n                            Div(col-sm-10){\nCode(\n    Range(t11_my,0,5)\n)\n                            }\n                            Div(col-sm-2){\n                                If(GetVar(t11_fail)){fail}.Else{ok}\n                            }\n                        }\n                    }\n                    Div(form-group row){\n                        Div(col-sm-2 text-muted text-center){\n                            Range(t12_none,20,0)\n                            SetVar(t12,\"\")\n                            ForList(t12_none){t12,#t12# #none_index#=#id#}\n                            If(#t12#==\"\"){\n                                SetVar(t12_ok, text-success)\n                            }.Else{\n                                SetVar(t12_fail, text-danger)\n                            }\n                        }\n                        Div(col-sm-10 #t12_ok# #t12_fail#){\n                            Div(col-sm-10){\nCode(\n    Range(t12_none,20,0)\n)\n                            }\n                            Div(col-sm-2){\n                                If(GetVar(t12_fail)){fail}.Else{ok}\n                            }\n                        }\n                    }\n                    Div(form-group row){\n                        Div(col-sm-2 text-muted text-center){\n                            SetVar(t13,\"\").(from, 5).(to, -4).(step,-2)\n                            Range(Source: neg, From: #from#, To: #to#, Step: #step#)\n                            ForList(neg){SetVar(t13,#t13# #neg_index#=#id#)}\n                            If(#t13#==\"1=5 2=3 3=1 4=-1 5=-3\"){\n                                SetVar(t13_ok, text-success)\n                            }.Else{\n                                SetVar(t13_fail, text-danger)\n                            }\n                        }\n                        Div(col-sm-10 #t13_ok# #t13_fail#){\n                            Div(col-sm-10){\nCode(\n    SetVar(t13,\"\").(from, 5).(to, -4).(step,-2) Range(Source: neg, From: #from#, To: #to#, Step: #step#)\n)\n                            }\n                            Div(col-sm-2){\n                                If(GetVar(t13_fail)){fail}.Else{ok}\n                            }\n                        }\n                    }\n                    Div(form-group row){\n                        Div(col-sm-2 text-muted text-center){\n                            SetVar(t14,\"\")\n                            Range(t14_zero,0,5,0)\n                            ForList(t14_zero){SetVar(t14,#t14# #zero_index#=#id#)}\n                            If(#t14#==\"\"){\n                                SetVar(t14_ok, text-success)\n                            }.Else{\n                                SetVar(t14_fail, text-danger)\n                            }\n                        }\n                        Div(col-sm-10 #t14_ok# #t14_fail#){\n                            Div(col-sm-10){\nCode(\n    Range(t14_zero,0,5,0)\n)\n                            }\n                            Div(col-sm-2){\n                                If(GetVar(t14_fail)){fail}.Else{ok}\n                            }\n                        }\n                    }\n                    Div(form-group row){\n                        Div(col-sm-2 text-muted text-center){\n                            SetVar(t15,\"\")\n                            JsonToSource(t15_none, [\"q\",\"p\"])\n                            ForList(t15_none){SetVar(t15,#t15# #key#:#value#)}\n                            If(#t15#==\"\"){\n                                SetVar(t15_ok, text-success)\n                            }.Else{\n                                SetVar(t15_fail, text-danger)\n                            }\n                        }\n                        Div(col-sm-10 #t15_ok# #t15_fail#){\n                            Div(col-sm-10){\nCode(\n    JsonToSource(t15_none, [\"q\",\"p\"])\n)\n                            }\n                            Div(col-sm-2){\n                                If(GetVar(t15_fail)){fail}.Else{ok}\n                            }\n                        }\n                    }\n                    Div(form-group row){\n                        Div(col-sm-2 text-muted text-center){\n                            SetVar(t17,\"\").(t17_obj,{\"p1\":\"v1\", \"p2\":\"v2\"})\n                            JsonToSource(t17_pv, #t17_obj#)\n                            ForList(t17_pv){SetVar(t17,#t17# #key#:#value#)}\n                            If(#t17#==\"p1:v1 p2:v2\"){\n                                SetVar(t17_ok, text-success)\n                            }.Else{\n                                SetVar(t17_fail, text-danger)\n                            }\n                        }\n                        Div(col-sm-10 #t17_ok# #t17_fail#){\n                            Div(col-sm-10){\nCode(\n    SetVar(t17,\"\").(t17_obj,{\"p1\":\"v1\", \"p2\":\"v2\"}) JsonToSource(t17_pv, #t17_obj#)\n)\n                            }\n                            Div(col-sm-2){\n                                If(GetVar(t17_fail)){fail}.Else{ok}\n                            }\n                        }\n                    }\n                    Div(form-group row){\n                        Div(col-sm-2 text-muted text-center){\n                            SetVar(t18,\"\")\n                            JsonToSource(t18_dat, {\"param\":\"va lue\", \"obj\": {\"sub\":\"one\"}, \"arr\":[\"one\"], \"empty\": null})\n                            ForList(t18_dat){SetVar(t18,#t18# #key#:#value#)}\n                            If(#t18#==\"arr:[one] empty: obj:map[sub:one] param:va lue\"){\n                                SetVar(t18_ok, text-success)\n                            }.Else{\n                                SetVar(t18_fail, text-danger)\n                            }\n                        }\n                        Div(col-sm-10 #t18_ok# #t18_fail#){\n                            Div(col-sm-10){\nCode(\n    JsonToSource(dat, {\"param\":\"va lue\", \"obj\": {\"sub\":\"one\"}, \"arr\":[\"one\"], \"empty\": null})\n)\n                            }\n                            Div(col-sm-2){\n                                If(GetVar(t18_fail)){fail}.Else{ok}\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n}",
            "Conditions": "ContractConditions(\"MainCondition\")",
            "Menu": "default_menu"
        }
    ],
    "parameters": [],
    "tables": [
        {
            "Name": "tests",
            "Columns": "[\n    {\n        \"name\": \"json\",\n        \"type\": \"json\",\n        \"conditions\": \"true\"\n    },\n    {\n        \"name\": \"name\",\n        \"type\": \"varchar\",\n        \"conditions\": \"true\"\n    },\n    {\n        \"name\": \"date\",\n        \"type\": \"datetime\",\n        \"conditions\": \"true\"\n    },\n    {\n        \"name\": \"result\",\n        \"type\": \"varchar\",\n        \"conditions\": \"true\"\n    }\n]",
            "Permissions": "{\"insert\":\"true\",\"update\":\"true\",\"new_column\":\"true\"}"
        }
    ]
}