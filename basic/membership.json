{
    "name": "Basic application",
    "data": [
        {
            "Type": "contracts",
            "Name": "catalog_ecosystems_Request",
            "Value": "contract catalog_ecosystems_Request {\r\n    data {\r\n        ecosystem_num int\r\n    }\r\n    \r\n    conditions {\r\n\r\n    }\r\n    \r\n    action {\r\n\r\n        //Sprintf(\"%d_roles_participants\", $ecosystem_num)\r\n        \r\n        var request_id int\r\n        request_id = DBInsert(\"membership_requests\", \"member_id,ecosystem_id\", $key_id, $ecosystem_num)\r\n\r\n        var admin_json string\r\n        admin_json = DBFind(\"roles_participants\").Where(\"role->id = ?\", 1).Ecosystem($ecosystem_num).One(\"member\")\r\n\r\n        var admin map\r\n        admin = JSONToMap(admin_json)\r\n\r\n        var req_params map\r\n        req_params[\"ecosystem_num\"] = $ecosystem_num\r\n\r\n/*\r\n        \r\n\r\n        var params map\r\n        params[\"rid\"] = 1\r\n        params[\"closure_type\"] = 1\r\n        params[\"sender\"] = $key_id\r\n        params[\"icon_name\"] = \"icon icon-user-follow\"\r\n        params[\"text_header\"] = \"New request for membership\"\r\n        params[\"text_body\"] = \"View details\"\r\n        params[\"page_name\"] = \"membership_admin_view\"\r\n        params[\"params_map\"] = notific_params\r\n\r\n\r\n\r\n        \r\n        \r\n        CallContract(Sprintf(\"@%dNotifications_Roles_Send_map\", $ecosystem_num), params)\r\n        */\r\n        var notific_params map\r\n        notific_params[\"request_id\"] = request_id\r\n        \r\n        \r\n        \r\n        Notifications_Single_Send_map(\"member_id,sender,icon_name,text_header,text_body,page_name,params_map\", admin[\"member_id\"], $key_id, \"icon icon-user-follow\", \"New request for membership\", \"View details\", \"membership_admin_view\", notific_params)\r\n    }\r\n}",
            "Conditions": "ContractConditions(\"MainCondition\")"
        },
        {
            "Type": "contracts",
            "Name": "membership_accept",
            "Value": "contract membership_accept {\r\n    data {\r\n        request_id int\r\n        notific_id int\r\n    }\r\n    conditions {\r\n\r\n    }\r\n    action {\r\n        Notifications_Single_Close(\"notific_id\", $notific_id)\r\n\r\n        var request map\r\n        request = DBFind(\"membership_requests\").Where(\"id = ?\", $request_id).Row()\r\n        DBUpdate(\"membership_requests\", $request_id, \"request_status\", 1)\r\n\r\n        var params map\r\n        params[\"request_id\"] = $request_id\r\n\r\n        Notifications_Single_Send_map(\"member_id,sender,icon_name,text_header,text_body,page_name,params_map\", request[\"member_id\"], $key_id, \"icon icon-user-follow\", \"Request is accepted\", \"Your request for membership is accepted\", \"membership_user_view\", params)\r\n    }\r\n}",
            "Conditions": "true"
        },
        {
            "Type": "contracts",
            "Name": "membership_decline",
            "Value": "contract membership_decline {\r\n    data {\r\n        request_id int\r\n        notific_id int\r\n    }\r\n    conditions {\r\n\r\n    }\r\n    action {\r\n        Notifications_Single_Close(\"notific_id\", $notific_id)\r\n\r\n        var request map\r\n        request = DBFind(\"membership_requests\").Where(\"id = ?\", $request_id).Row()\r\n        DBUpdate(\"membership_requests\", $request_id, \"request_status\", -1)\r\n\r\n        var params map\r\n        params[\"request_id\"] = $request_id\r\n\r\n        Notifications_Single_Send_map(\"member_id,sender,icon_name,text_header,text_body,page_name,params_map\", request[\"member_id\"], $key_id, \"icon icon-user-follow\", \"Request is rejected\", \"Your request for membership is rejected\", \"membership_admin_view\", params)\r\n    }\r\n}",
            "Conditions": "true"
        },
        {
            "Type": "pages",
            "Name": "catalog_ecosystems_view",
            "Value": "Div(content-wrapper){\r\n    DBFind(Name:applications, Source:src_app).Columns(\"name,id\").Where(\"name='Basic application'\").Vars(app)\r\n    DBFind(Name: catalog_ecosystems, Source: src_catalog).Columns(\"id,ecosystem_name,ecosystem_type,ecosystem_number,image_id,flag_free,ecosystem_info->email,ecosystem_info->phone,ecosystem_info->description,ecosystem_info->conditions,url_address->vde_form_address,url_address->web_page,url_address->vde_page,url_address->web_form_address\").Where(\"id=#v_id#\").Vars(prefix)\r\n    \r\n    SetTitle($catalog_ecosystems_number$: #prefix_ecosystem_name#)\r\n    Div(breadcrumb){\r\n        LinkPage($catalog_ecosystems$, catalog_ecosystems)\r\n        Span(/).Style(margin-right: 10px; margin-left: 10px;)\r\n        Span(Class: text-muted, Body: #prefix_ecosystem_name#)\r\n    }\r\n    \r\n    Div(row){\r\n        Div(col-md-10 col-md-offset-1){\r\n            Form(panel panel-default){\r\n                Div(panel-heading text-center){\r\n                    Span(Class: text-bold h3, Body: #prefix_ecosystem_name# (##prefix_ecosystem_number#))\r\n                }\r\n                Div(panel-body){\r\n                    Div(form-group){\r\n                        Div(row mb-sm){\r\n                            Div(col-md-12 mt-sm text-center){\r\n                                If(#prefix_image_id# > 0){\r\n                                    DBFind(Name: binaries, Source: src_binaries).Columns(\"data\").Where(\"id=#prefix_image_id#\").Vars(img)\r\n                                    Image(Src: \"#img_data#\").Style(width: 300px;)\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    Div(form-group){\r\n                        Div(row mb-sm){\r\n                            Div(col-md-6 mc-sm text-right){\r\n                                P(Class: h5 text-normal m0){\r\n                                    Span(Body: LangRes(type)).(Class: text-danger, Body:*)\r\n                                }\r\n                            }\r\n                            Div(col-md-6 mc-sm text-left){\r\n                                P(Class: h5 text-normal m0, Body: AppParam(App:#app_id#, Name: catalog_ecosystems_type, Index: #prefix_ecosystem_type#))\r\n                            }\r\n                        }\r\n                        Div(row mb-sm){\r\n                            Div(col-md-6 mc-sm text-right){\r\n                                P(Class: h5 text-normal m0){\r\n                                    Span(Body: LangRes(catalog_ecosystems_description)).(Class: text-danger, Body:*)\r\n                                }\r\n                            }\r\n                            Div(col-md-6 mc-sm text-left){\r\n                                P(Class: h5 text-normal m0, Body: #prefix_ecosystem_info_description#)\r\n                            }\r\n                        }\r\n                    }\r\n                    Div(form-group){\r\n                        Div(row mb-sm){\r\n                            Div(col-md-6 mc-sm text-right){\r\n                                P(Class: h5 text-normal m0){\r\n                                    Span(Body: LangRes(catalog_ecosystems_freetype)).(Class: text-danger, Body:*)\r\n                                }\r\n                            }\r\n                            Div(col-md-6 mc-sm text-left){\r\n                                P(Class: h5 text-normal m0, Body: AppParam(App:#app_id#, Name: catalog_ecosystems_freetype, Index: #prefix_flag_free#))\r\n                            }\r\n                        }\r\n                        Div(row mb-sm){\r\n                            Div(col-md-6 mc-sm text-right){\r\n                                P(Class: h5 text-normal m0){\r\n                                    Span(Body: LangRes(catalog_ecosystems_conditions)).(Class: text-danger, Body:*)\r\n                                }\r\n                            }\r\n                            Div(col-md-6 mc-sm text-left){\r\n                                P(Class: h5 text-normal m0, Body: #prefix_ecosystem_info_conditions#)\r\n                            }\r\n                        }\r\n                    }\r\n                    Div(form-group){\r\n                        Div(row mb-sm){\r\n                            Div(col-md-6 mc-sm text-right){\r\n                                P(Class: h5 text-normal m0, Body: LangRes(vde_form_desc))\r\n                            }\r\n                            Div(col-md-6 mc-sm text-left){\r\n                                P(Class: h5 text-normal m0, Body: #prefix_url_address_vde_form_address#)\r\n                            }\r\n                        }\r\n                        Div(row mb-sm){\r\n                            Div(col-md-6 mc-sm text-right){\r\n                                P(Class: h5 text-normal m0, Body: LangRes(vde_page))\r\n                            }\r\n                            Div(col-md-6 mc-sm text-left){\r\n                                P(Class: h5 text-normal m0, Body: #prefix_url_address_vde_page#)\r\n                            }\r\n                        }\r\n                    }\r\n                    Div(form-group){\r\n                        Div(row mb-sm){\r\n                            Div(col-md-6 mc-sm text-right){\r\n                                P(Class: h5 text-normal m0, Body: LangRes(web_form_desc))\r\n                            }\r\n                            Div(col-md-6 mc-sm text-left){\r\n                                P(Class: h5 text-normal m0, Body: #prefix_url_address_web_form_address#)\r\n                            }\r\n                        }\r\n                        Div(row mb-sm){\r\n                            Div(col-md-6 mc-sm text-right){\r\n                                P(Class: h5 text-normal m0, Body: LangRes(web_page))\r\n                            }\r\n                            Div(col-md-6 mc-sm text-left){\r\n                                P(Class: h5 text-normal m0, Body: #prefix_url_address_web_page#)\r\n                            }\r\n                        }\r\n                    }\r\n                    Div(form-group){\r\n                        Div(row mb-sm){\r\n                            Div(col-md-6 mc-sm text-right){\r\n                                P(Class: h5 text-normal m0, Body: LangRes(catalog_ecosystems_contact_email))\r\n                            }\r\n                            Div(col-md-6 mc-sm text-left){\r\n                                P(Class: h5 text-normal m0, Body: #prefix_ecosystem_info_email#)\r\n                            }\r\n                        }\r\n                        Div(row mb-sm){\r\n                            Div(col-md-6 mc-sm text-right){\r\n                                P(Class: h5 text-normal m0, Body: LangRes(catalog_ecosystems_contact_phone))\r\n                            }\r\n                            Div(col-md-6 mc-sm text-left){\r\n                                P(Class: h5 text-normal m0, Body: #prefix_ecosystem_info_phone#)\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                DBFind(Name: keys, Source: src_keys).Where(\"id = #key_id#\").Vars(key)\r\n                If(#key_amount# > 0){\r\n                    DBFind(Name: membership_requests, Source: src_membership).Ecosystem(\"#prefix_ecosystem_number#\").Where(\"member_id = #key_id#\").Vars(request)\r\n                    If(#request_id#>0){\r\n                        Div(row form-group){\r\n                            Div(col-md-12 mt-sm text-center){\r\n                                If(#request_status# == 0){\r\n                                    Em(Class: fa fa-question-circle fa-5x text-warning)\r\n                                    Div(text-center h4 text-bold text-warning, Body: LangRes(request_wating))\r\n                                }\r\n                                If(#request_status# == 1){\r\n                                    Em(Class: fa fa-check-circle fa-5x text-success)\r\n                                    Div(text-center h4 text-bold text-success, Body: LangRes(request_accepted))\r\n                                }\r\n                                If(#request_status# == -1){\r\n                                    Em(Class: fa fa-minus-circle fa-5x text-danger)\r\n                                    Div(text-center h4 text-bold text-danger, Body: LangRes(request_rejected))\r\n                                }\r\n                            }\r\n                        }\r\n                        \r\n                    }.Else{\r\n                        Div(row form-group){\r\n                            Div(col-md-12 mt-sm text-center){\r\n                                Em(Class: fa fa-exclamation-circle fa-5x text-primary)\r\n                                Div(text-center h4 text-bold text-primary, Body: LangRes(request_not_sent))\r\n                            }\r\n                        }\r\n                        Div(panel-footer text-right){\r\n                            Button(Body: LangRes(send), Class: btn btn-primary, Contract: catalog_ecosystems_Request, Params: \"ecosystem_num=#prefix_ecosystem_number#\", Page: \"catalog_ecosystems\")\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}",
            "Conditions": "ContractAccess(\"@1EditPage\")",
            "Menu": "default_menu"
        },
        {
            "Type": "tables",
            "Name": "membership_requests",
            "Columns": "[{\"name\":\"member_id\",\"type\":\"number\",\"conditions\":\"true\"},{\"name\":\"ecosystem_id\",\"type\":\"number\",\"conditions\":\"true\"},{\"name\":\"request_status\",\"type\":\"number\",\"conditions\":\"true\"}]",
            "Permissions": "{\"insert\": \"ContractConditions(\\\"MainCondition\\\")\", \"update\": \"ContractConditions(\\\"MainCondition\\\")\", \"new_column\": \"ContractConditions(\\\"MainCondition\\\")\"}"
        }
    ]
}