{
    "blocks": [],
    "contracts": [
        {
            "Name": "Profile_Edit",
            "Value": "contract Profile_Edit {\n    data {\n        member_name string\n        avatar string \"image\"\n        param_key_str string \"optional\"\n    }\n\n    conditions {\n        $param_key_int = 0\n\n        // choice of key\n        if (Size($param_key_str) == 0) {\n            $param_key_int = $key_id\n        } else {\n            $param_key_int = Int($param_key_str)\n        }\n\n        // search for member\n        $member_id = DBFind(\"members\").Where(\"id = $\", $param_key_int).One(\"id\")\n\n        // check editing\n        if (($member_id != nil) && ($param_key_int != $key_id)) {\n            warning \"You can not edit another member\"\n        }\n    }\n\n    action {\n        if $member_id {\n            DBUpdate(\"members\", Int($member_id), \"member_name,avatar\", $member_name, $avatar)\n        } else {\n            DBInsert(\"members\", \"id,member_name,avatar\", $param_key_int, $member_name, $avatar)\n        }\n    }\n}",
            "Conditions": "ContractConditions(\"MainCondition\")"
        },
        {
            "Name": "membership_Request_Accept",
            "Value": "contract membership_Request_Accept {\n    data {\n        v_id int\n    }\n\n    conditions {\n        MainCondition()\n\n        $request_map = DBFind(\"vde_membership_requests\").Where(\"id=$\", $v_id).Row()\n\t\tif !$request_map{\n\t\t\twarning \"Request not found\"\n\t\t}\n\n        $key_map = DBFind(\"keys\").Where(\"id=$\", Int($request_map[\"member_id\"])).Row()\n\t\tif $key_map{\n\t\t\twarning \"This key has already been added\"\n\t\t}\n    }\n\n    action {\n        DBInsert(\"keys\", \"id,pub,amount\", Int($request_map[\"member_id\"]), Str($request_map[\"pub_key\"]), 0)\n        DBUpdate(\"vde_membership_requests\", $v_id, \"status\", 1)\n        Profile_Edit(\"param_key_str,member_name,avatar\", Str($request_map[\"member_id\"]), Str($request_map[\"member_name\"]), Str($request_map[\"avatar\"]))\n    }\n}",
            "Conditions": "ContractConditions(\"MainCondition\")"
        },
        {
            "Name": "membership_Request_Reject",
            "Value": "contract membership_Request_Reject {\n    data {\n        v_id int\n    }\n\n    conditions {\n        MainCondition()\n    }\n\n    action {\n        DBUpdate(\"vde_membership_requests\", $v_id, \"status\", -1)\n    }\n}",
            "Conditions": "ContractConditions(\"MainCondition\")"
        }
    ],
    "data": [],
    "languages": [],
    "menus": [
        {
            "Name": "default_menu",
            "Value": "MenuItem(Title:$profile$, Page:profile_view, Icon:\"fa icon-user\")\nMenuItem(Title:$membership$, Page:members_list, Icon:\"fa icon-people\")",
            "Conditions": "ContractAccess(\"@1EditMenu\")"
        }
    ],
    "pages": [
        {
            "Name": "members_list",
            "Value": "Div(Class: content-wrapper){\n\n\tSetTitle($membership$)\n\tDiv(breadcrumb){\n\t\tSpan(Class: text-muted, Body: $membership$)\n\t}\n\n    If(GetVar(isSearch) == 1){\n        SetVar(Name: v_Where, Value: \"member_name='#v_Search#'\")\n    }.Else{\n        SetVar(Name: v_Where, Value: \"id!=0\")\n        SetVar(Name: v_Search, Value: \"\")\n    }\n\n    DBFind(Name: members, Source: src_member).Custom(custom_username){\n        LinkPage(Page: profile_view, PageParams: \"v_member_id=#id#\"){\n            If(#avatar# != \"\"){\n                Image(Src: \"#avatar#\", Class: img-circle).Style(width: 30px;  border: 1px solid #5A5D63; margin-right: 10px;)\n            }\n            Span(Class: h5 text-bold, Body: #member_name#)\n        }\n\t}.Custom(custom_member_id){\n        Span(Body: Address(#id#))\n    }.Where(#v_Where#).Order(\"member_name\")\n\n    Div(Class: panel panel-primary){\n        Form(){\n            Div(Class: list-group-item){\n                Div(Class: row df f-valign){\n                    Div(Class: col-md-1 mt-sm text-right){\n                        Label(For: Search){\n                            Span(Body: LangRes(username))\n                        }\n                    }\n                    Div(Class: col-md-11 mc-sm){\n                        Div(Class: input-group){\n                            Input(Class: form-control, Type: text, Name: Search, Value: #v_Search#)\n                            Div(Class: input-group-btn){\n                                Button(Body: Em(Class: fa fa-search), Class: btn btn-default, Page: members_list, PageParams: \"isSearch=1,v_Search=Val(Search)\")\n                            }\n                        }\n                    }\n                }  \n            }\n            Div(Class: list-group-item){ \n                Table(Source: src_member, Columns: \"$username$=custom_username,$id$=id,$member_id$=custom_member_id\")\n                If(GetVar(isSearch) == 1){\n                    Div(Class: text-center){  \n                        Button(Body: $view_all$, Class: btn btn-primary, Page: members_list, PageParams: \"isSearch=0\")\n                    }\n                }\n            }\n        }           \n    }\n\t\n    DBFind(Name: vde_membership_requests, Source: src_requests).Custom(custom_id){\n\t\tIf(#status#==0){\n\t\t\tSpan(Class: text-normal, Body: #id#)\n\t\t}.Else{\n\t\t\tSpan(Class: text-muted, Body: #id#)\n\t\t}\n\t}.Custom(custom_comment){\n\t\tIf(#status#==0){\n\t\t\tSpan(Class: text-normal, Body: #comment#)\n\t\t}.Else{\n\t\t\tSpan(Class: text-muted, Body: #comment#)\n\t\t}\n\t}.Custom(custom_username){\n\t\tImage(Src: \"#avatar#\", Class: img-circle).Style(width: 30px;  border: 1px solid #5A5D63; margin-right: 10px;)\n\t\tIf(#status#==0){\n\t\t\tSpan(Class: h5 text-bold, Body: #member_name#)\n\t\t}.Else{\n\t\t\tSpan(Class: h5 text-bold text-muted, Body: #member_name#)\n\t\t}\n\t}.Custom(custom_member_id){\n\t\tIf(#status#==0){\n\t\t\tSpan(Class: text-normal, Body: Address(#member_id#))\n\t\t}.Else{\n\t\t\tSpan(Class: text-muted, Body: Address(#member_id#))\n\t\t}\n    }.Custom(custom_status){\n        If(#status#==0){\n            Span(Class: text-normal, Body: LangRes(waiting))\n        }\n        If(#status#==-1){\n            Span(Class: text-muted, Body: LangRes(rejected))\n        }\n\t}.Custom(buttons){\n\t\tIf(#status#==0){\n\t\t\tDiv(Class: pull-right){\n\t\t\t\tSpan(){ \n\t\t\t\t\tButton(Class: btn btn-success, Body: Em(Class:fa fa-check) $accept$, Contract: membership_Request_Accept, Params: \"v_id=#id#\", Page: members_list).Alert(Text: $membership_request_accept$, ConfirmButton: $yes$, CancelButton: $no$, Icon: question)\n\t\t\t\t}.Style(margin-right: 20px;)\n\t\t\t\tButton(Class: btn btn-danger, Body: Em(Class:fa fa-close) $reject$, Contract: membership_Request_Reject, Params: \"v_id=#id#\", Page: members_list).Alert(Text: $membership_request_reject$, ConfirmButton: $yes$, CancelButton: $no$, Icon: question)\n\t\t\t}\t\t\n\t\t}\n    }.Where(\"status=0 or status=-1\").Order(\"status desc, id asc\")\t\n\t\n    Div(Class: panel panel-primary){\n        Form(){\n\t\t\tDiv(Class: list-group-item text-center){\n\t\t\t\tSpan(Class: h3, Body: LangRes(membership_requests))\t\n\t\t\t}\n            Div(Class: list-group-item){ \n                Table(Source: src_requests, Columns: \"$id$=custom_id,$username$=custom_username,$member_id$=custom_member_id,$comment$=custom_comment,$status$=custom_status,=buttons\")\n            }\n        }           \n    }\n\n}",
            "Conditions": "ContractAccess(\"@1EditPage\")",
            "Menu": "default_menu"
        },
        {
            "Name": "profile_edit",
            "Value": "Div(Class: content-wrapper){\n\n\tSetTitle($editing_profile$)\n\tDiv(Class: breadcrumb){\n\t\tLinkPage($user_info$, profile_view)\n\t\tSpan(/).Style(margin-right: 10px; margin-left: 10px;)\n\t\tSpan(Class: text-muted, Body: $editing_profile$)\n\t}\n\n\tIf(Or(#v_member_id#>0,#v_member_id#<0)){\n        DBFind(Name: members, Source: src_member).Where(id=#v_member_id#).Vars(prefix)\n    }.Else{\n        DBFind(Name: members, Source: src_member).Where(id=#key_id#).Vars(prefix)\n    }\n\n    If(Or(#prefix_id#>0,#prefix_id#<0)){\n\t\tSetVar(Name: prefix_birthdate, Value: DateTime(DateTime: #prefix_birthdate#, Format: \"YYYY-MM-DD\"))\n    }.Else{\n        SetVar(Name: prefix_member_name, Value: \"\")\n    }\n\n    Div(Class: row df f-valign){\n        Div(Class: col-md-3)\n        Div(Class: col-md-6){\n            Div(Class: panel panel-primary){\n                Div(Class: panel-heading, Body: LangRes(editing_profile))\n                Form(){ \n\n\t\t\t\t\tDiv(Class: list-group-item){\n\t\t\t\t\t\tDiv(Class: row df f-valign){\n\t\t\t\t\t\t\tDiv(Class: col-md-3 mt-sm text-right){\n\t\t\t\t\t\t\t\tLabel(For: username){\n\t\t\t\t\t\t\t\t\tSpan(Body: LangRes(username))\n      \t\t\t\t\t\t\t\tSpan(Class: text-danger, Body:*)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tDiv(Class: col-md-9 mc-sm text-left){\n\t\t\t\t\t\t\t\tInput(Class: form-control, Type: text, Name: member_name, Value: #prefix_member_name#)\n\t\t\t\t\t\t\t} \n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tDiv(Class: list-group-item){\n\t\t\t\t\t\tDiv(Class: row df f-valign){\n\t\t\t\t\t\t\tDiv(Class: col-md-3 mt-sm text-right){\n\t\t\t\t\t\t\t\tLabel(For: avatar){\n\t\t\t\t\t\t\t\t\tSpan(Body: LangRes(avatar))\n\t\t\t\t\t\t\t\t\tSpan(Class: text-danger, Body:*)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tDiv(col-md-9 mc-sm text-left){\n\t\t\t\t\t\t\t\tImageInput(Name: avatar, Width: 100, Ratio: 1/1)\n\t\t\t\t\t\t\t} \n\t\t\t\t\t\t}\n\t\t\t\t\t}\n                    \n\t\t\t\t\tDiv(Class: panel-footer clearfix){\n\t\t\t\t\t\tDiv(Class: pull-right){\n\t\t\t\t\t\t\tButton(Body: LangRes(save), Class: btn btn-primary, Contract: Profile_Edit , Page: members_list,).Alert(Text: $want_save_changes$, ConfirmButton: $yes$, CancelButton: $no$, Icon: question)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n                }\n            }\n        }\n        Div(Class: col-md-3)\n    }\n}",
            "Conditions": "ContractAccess(\"@1EditPage\")",
            "Menu": "default_menu"
        },
        {
            "Name": "profile_view",
            "Value": "Div(Class: content-wrapper){\n\n\tSetTitle($user_info$)\n\tDiv(Class: breadcrumb){\n\t\tSpan(Class: text-muted, Body: LangRes(user_info))\n\t}\n\n    If(Or(#v_member_id#>0,#v_member_id#<0)){\n    }.Else{\n\t\tSetVar(Name: v_member_id, Value: #key_id#)\n    }\n\tDBFind(Name: members, Source: src_member).Where(id=#v_member_id#).Vars(prefix)\n\tDBFind(Name: keys, Source: src_keys).Where(id=#v_member_id#).Vars(tokens)\t\n\t\n\tIf(Or(#prefix_id#>0,#prefix_id#<0)){\n    }.Else{\n        SetVar(Name: prefix_member_name, Value: \"\")\n    }\n\n    Div(Class: row df f-valign){\n        Div(Class: col-md-3)\n        Div(Class: col-md-6){\n            Div(Class: panel panel-default){\n                Form(){ \n\t\t\t\t\tDiv(Class: list-group-item text-center){\n\t\t\t\t\t\tSpan(Class: h3, Body: LangRes(user_info))\t\n\t\t\t\t\t}\n\t\t\t\t\tDiv(Class: list-group-item){\n\t\t\t\t\t\tDiv(Class: row df f-valign){\n\t\t\t\t\t\t\tDiv(Class: col-md-12 mt-sm text-center){\n\n\t\t\t\t\t\t\t\tIf(Or(#prefix_id#>0,#prefix_id#<0)){\n\t\t\t\t\t\t\t\t\tIf(#prefix_id# == #key_id#){\n\t\t\t\t\t\t\t\t\t\tButton(Class: btn btn-link, Page: profile_edit, PageParams: \"v_member_id=#id#\"){\n                                            If(#prefix_avatar# != \"\"){\n\t\t\t\t\t\t\t\t\t\t\t    Image(Src: \"#prefix_avatar#\", Class: img-circle).Style(width: 100px;  border: 1px solid #5A5D63; margin-bottom: 15px;)\n\t\t\t\t\t\t\t\t\t\t\t}\n                                            Div(Body: Span(Class: h3 text-bold, Body: #prefix_member_name#))\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}.Else{\n                                        If(#prefix_avatar# != \"\"){\n\t\t\t\t\t\t\t\t\t\t    Image(Src: \"#prefix_avatar#\", Class: img-circle).Style(width: 100px;  border: 1px solid #5A5D63; margin-bottom: 15px;)\n\t\t\t\t\t\t\t\t\t\t}\n                                        Div(Body: Span(Class: h3 text-bold, Body: #prefix_member_name#))\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}.Else{\n\t\t\t\t\t\t\t\t\tButton(Class: btn btn-link, Page: profile_edit){\n\t\t\t\t\t\t\t\t\t\tSpan(Class: h3 text-bold, Body: LangRes(editing_profile))\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tDiv(Class: list-group-item){\n\t\t\t\t\t\tDiv(Class: row df f-valign){\n\t\t\t\t\t\t\tDiv(Class: col-md-12 mt-sm text-center){\n\t\t\t\t\t\t\t\tSpan(Class: h4 text-bold, Body: Address(#prefix_id#))\n\t\t\t\t\t\t\t\tDiv(Class: text-muted m0 h5, Body: LangRes(member_id))\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\t\t\t\t\t\n\n                }\n            }\n\n        }\n        Div(Class: col-md-3)\n    }\n}",
            "Conditions": "ContractAccess(\"@1EditPage\")",
            "Menu": "default_menu"
        }
    ],
    "parameters": [],
    "tables": []
}