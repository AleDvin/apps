contract test_voting_Create{
    data{
        Start string "datetime"
        End string "datetime"
        StartTime string "datetime"
        EndTime string "datetime"
    }
    
    action{
        var volume, quorum, vacancies int
        volume = 50
        quorum = 50
        vacancies = 1
        
        var subject, voters, candidates, initContract, contractAccept, paramsAccept, contractReject, paramsReject string
        subject = "voting template subject"
        
        var candidateRole map
        candidateRole = DBFind("roles").Where("deleted=0 and (role_type=2 or role_type=3)").Row() 
        if !candidateRole{
            warning "Candidate role not found"
        }
        candidates = candidateRole["id"] 
        
        var voterRole map
        voterRole = DBFind("roles").Where("deleted=0").Row()
        if !voterRole {
            warning "Voter role not found"
        }
        voters = voterRole["id"] 
        initContract = "test_voting_Init"
        contractAccept = "test_voting_Accept"
        paramsAccept = ""
        contractReject = "test_voting_Reject"
        paramsReject = ""
        
        var p, d, v int // types of participant, decision, voting
        d = 1
        while d <= 5 {
            p = 2
            while p <= 3 {
                v = 1
                while v <= 2 {
                    var title string
                    title = Sprintf("New Voting [d%v:p%v:v%v]", d, p, v)
                    
                    var templateId, kid int
                    voting_TemplateStore("Title,TypeParticipants,TypeVoting,TypeDecision,Volume,Quorum,Subject,Voters,Candidates,InitContract,Vacancies,ContractAccept,ParamsAccept,ContractReject,ParamsReject", title,p,v,d,volume,quorum,subject,voters,candidates,initContract,vacancies,contractAccept,paramsAccept,contractReject,paramsReject)
                    templateId = $result

                    var tableWritten, rowId, columnName, newValue, textDocument string
                    tableWritten = "debug"
                    rowId = "1"
                    columnName = "value1"
                    newValue = Sprintf("It is new value for template #%v", templateId)
                    textDocument = Sprintf("Test text Document for voting template #%v", templateId)
                    
                    voting_TemplateRun("TemplateId,Start,End,EndTime,StartTime,KeyId,TableWritten,RowId,ColumnName,NewValue,TextDocument", templateId, $Start, $End, $EndTime, $StartTime, kid, tableWritten, rowId, columnName, newValue, textDocument)
                    
                    v = v+1
                }
                p = p+1
            }
            d = d+1
        }
    }
}