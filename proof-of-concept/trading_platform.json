{
    "name": "Trading Platform",
    "data": [
        {
            "Conditions": "ContractAccess(\"@1EditMenu\")",
            "Value": "MenuItem(Title:$lots_list$, Page: lots_list, Icon:\"icon-list\")",
            "Name": "default_menu",
            "Type": "menu"
        },
        {
            "Name": "amount_final",
            "Trans": "{\n    \"ru\": \"Конечная сумма\",\n    \"en\": \"The final amount\"\n}",
            "Type": "languages"
        },
        {
            "Name": "amount_starting",
            "Trans": "{\n    \"ru\": \"Стартовая сумма\",\n    \"en\": \"The starting amount\"\n}",
            "Type": "languages"
        },
        {
            "Name": "buyer",
            "Trans": "{\n    \"ru\": \"Покупатель\",\n    \"en\": \"Buyer\"\n}",
            "Type": "languages"
        },
        {
            "Name": "date_creation",
            "Trans": "{\n    \"ru\": \"Дата создания\",\n    \"en\": \"Created date\"\n}",
            "Type": "languages"
        },
        {
            "Name": "lot_deleted",
            "Trans": "{\n    \"ru\": \"Лот удалён\",\n    \"en\": \"Lot deleted\"\n}",
            "Type": "languages"
        },
        {
            "Name": "lot_edit",
            "Trans": "{\n    \"ru\": \"Редактировать\",\n    \"en\": \"Edit\"\n}",
            "Type": "languages"
        },
        {
            "Name": "lots_amount_max",
            "Trans": "{\n    \"ru\": \"Текущая максимальная сумма\",\n    \"en\": \"The current maximum amount\"\n}",
            "Type": "languages"
        },
        {
            "Name": "lots_bid",
            "Trans": "{\n    \"ru\": \"Сделать ставку\",\n    \"en\": \"Bet\"\n}",
            "Type": "languages"
        },
        {
            "Name": "lots_bidding",
            "Trans": "{\n    \"ru\": \"Идут торги\",\n    \"en\": \"Trades are\"\n}",
            "Type": "languages"
        },
        {
            "Name": "lots_contract",
            "Trans": "{\n    \"ru\": \"Договор\",\n    \"en\": \"The contract\"\n}",
            "Type": "languages"
        },
        {
            "Name": "lots_create",
            "Trans": "{\n    \"ru\": \"Создать лот\",\n    \"en\": \"To create a lot\"\n}",
            "Type": "languages"
        },
        {
            "Name": "lots_date_end",
            "Trans": "{\n    \"ru\": \"Дата окончания торгов\",\n    \"en\": \"The end date of the auction\"\n}",
            "Type": "languages"
        },
        {
            "Name": "lots_date_start",
            "Trans": "{\n    \"ru\": \"Дата начала торгов\",\n    \"en\": \"Beginning date of\"\n}",
            "Type": "languages"
        },
        {
            "Name": "lots_delete",
            "Trans": "{\n    \"ru\": \"Удалить лот\",\n    \"en\": \"To remove lot\"\n}",
            "Type": "languages"
        },
        {
            "Name": "lots_delete_auction",
            "Trans": "{\n    \"ru\": \"Вы действительно хотите удалить аукцион?\",\n    \"en\": \"Do you want to remove the auction?\"\n}",
            "Type": "languages"
        },
        {
            "Name": "lots_description",
            "Trans": "{\n    \"ru\": \"Описание\",\n    \"en\": \"Description\"\n}",
            "Type": "languages"
        },
        {
            "Name": "lots_edit",
            "Trans": "{\n    \"ru\": \"Редактирование лота\",\n    \"en\": \"Edit the lot\"\n}",
            "Type": "languages"
        },
        {
            "Name": "lots_list",
            "Trans": "{\n    \"ru\": \"Список лотов\",\n    \"en\": \"List of lots\"\n}",
            "Type": "languages"
        },
        {
            "Name": "lots_name",
            "Trans": "{\n    \"ru\": \"Название\",\n    \"en\": \"Name\"\n}",
            "Type": "languages"
        },
        {
            "Name": "lots_no",
            "Trans": "{\n    \"ru\": \"Нет\",\n    \"en\": \"No\"\n}",
            "Type": "languages"
        },
        {
            "Name": "lots_not_found",
            "Trans": "{\n    \"ru\": \"Лоты не найдены\",\n    \"en\": \"Lots not found\"\n}",
            "Type": "languages"
        },
        {
            "Name": "lots_signed",
            "Trans": "{\n    \"ru\": \"Торги завершены, подпись получена\",\n    \"en\": \"The bidding is completed, the signature obtained\"\n}",
            "Type": "languages"
        },
        {
            "Name": "lots_status",
            "Trans": "{\n    \"ru\": \"Статус\",\n    \"en\": \"Status\"\n}",
            "Type": "languages"
        },
        {
            "Name": "lots_subscribe",
            "Trans": "{\n    \"ru\": \"Подписаться\",\n    \"en\": \"Subscribe\"\n}",
            "Type": "languages"
        },
        {
            "Name": "lots_view",
            "Trans": "{\n    \"ru\": \"Просмотр лота\",\n    \"en\": \"View of the lot\"\n}",
            "Type": "languages"
        },
        {
            "Name": "lots_waiting_for_sign",
            "Trans": "{\n    \"ru\": \"Торги завершены, ожидание подписи\",\n    \"en\": \"Bidding completed, pending signature\"\n}",
            "Type": "languages"
        },
        {
            "Name": "lots_waiting_for_start",
            "Trans": "{\n    \"ru\": \"Ожидание начала торгов\",\n    \"en\": \"Waiting to start trading\"\n}",
            "Type": "languages"
        },
        {
            "Name": "lots_yes",
            "Trans": "{\n    \"ru\": \"Да\",\n    \"en\": \"Yes\"\n}",
            "Type": "languages"
        },
        {
            "Name": "order_max",
            "Trans": "{\n    \"ru\": \"Максимальная ставка\",\n    \"en\": \"The maximum rate\"\n}",
            "Type": "languages"
        },
        {
            "Name": "order_min",
            "Trans": "{\n    \"ru\": \"Минимальная ставка\",\n    \"en\": \"The minimum bet\"\n}",
            "Type": "languages"
        },
        {
            "Name": "photo",
            "Trans": "{\n    \"ru\": \"Фото\",\n    \"en\": \"Photo\"\n}",
            "Type": "languages"
        },
        {
            "Name": "seller",
            "Trans": "{\n    \"ru\": \"Продавец\",\n    \"en\": \"Seller\"\n}",
            "Type": "languages"
        },
        {
            "Name": "buyers",
            "Columns": "[{\"conditions\":\"true\",\"name\":\"amount\",\"type\":\"money\"},{\"conditions\":\"true\",\"name\":\"lot_id\",\"type\":\"number\"},{\"conditions\":\"true\",\"name\":\"buyer_id\",\"type\":\"number\"}]",
            "Permissions": "{\"insert\": \"ContractConditions(\\\"MainCondition\\\")\", \"update\": \"ContractConditions(\\\"MainCondition\\\")\", \"new_column\": \"ContractConditions(\\\"MainCondition\\\")\"}",
            "Type": "tables"
        },
        {
            "Name": "lots",
            "Columns": "[{\"conditions\":\"true\",\"name\":\"status\",\"type\":\"number\"},{\"conditions\":\"true\",\"name\":\"deleted\",\"type\":\"number\"},{\"conditions\":\"true\",\"name\":\"photo\",\"type\":\"number\"},{\"conditions\":\"true\",\"name\":\"order_min\",\"type\":\"money\"},{\"conditions\":\"true\",\"name\":\"amount_final\",\"type\":\"money\"},{\"conditions\":\"true\",\"name\":\"date_creation\",\"type\":\"datetime\"},{\"conditions\":\"true\",\"name\":\"name\",\"type\":\"text\"},{\"conditions\":\"true\",\"name\":\"seller\",\"type\":\"number\"},{\"conditions\":\"true\",\"name\":\"order_max\",\"type\":\"money\"},{\"conditions\":\"true\",\"name\":\"amount_max\",\"type\":\"money\"},{\"conditions\":\"true\",\"name\":\"buyer\",\"type\":\"number\"},{\"conditions\":\"true\",\"name\":\"date_start\",\"type\":\"datetime\"},{\"conditions\":\"true\",\"name\":\"contract_id\",\"type\":\"number\"},{\"conditions\":\"true\",\"name\":\"description\",\"type\":\"text\"},{\"conditions\":\"true\",\"name\":\"amount_starting\",\"type\":\"money\"},{\"conditions\":\"true\",\"name\":\"date_end\",\"type\":\"datetime\"}]",
            "Permissions": "{\"insert\": \"ContractConditions(\\\"MainCondition\\\")\", \"update\": \"ContractConditions(\\\"MainCondition\\\")\", \"new_column\": \"ContractConditions(\\\"MainCondition\\\")\"}",
            "Type": "tables"
        },
        {
            "Conditions": "true",
            "Value": "lots_waiting_for_start,lots_bidding,lots_waiting_for_sign,lots_signed",
            "Name": "lots_status",
            "Type": "app_params"
        },
        {
            "Conditions": "true",
            "Value": "If(GetVar(Id)){\r\n    DBFind(lots, src_lots).Where(\"id=#Id#\").Vars(lot)\r\n    SetVar(title, $lots_edit$)\r\n}.Else{\r\n    SetVar(title, $lots_create$)\r\n}\r\nSetTitle(#title#)\r\n\r\nSetVar(amount_starting, Money(#lot_amount_starting#)).(amount_final, Money(#lot_amount_final#)).(order_min, Money(#lot_order_min#)).(order_max, Money(#lot_order_max#)).(date_start, DateTime(#lot_date_start#, YYYY-MM-DD)).(date_end, DateTime(#lot_date_end#, YYYY-MM-DD))\r\n\r\nDiv(content-wrapper){\r\n    Div(breadcrumb){\r\n        LinkPage($lots_list$, lots_list)\r\n        Span(/,mh)\r\n        Span(Class: text-muted, Body: #title#)\r\n    }\r\n\r\n    Div(row){\r\n        Div(col-md-8 col-md-offset-2 col-lg-6 col-lg-offset-3){\r\n            Form(panel panel-primary){\r\n                Div(panel-heading){#title#}\r\n                Div(panel-body){\r\n                    If(GetVar(Id)) {\r\n                        Input(Name: Id, Type: hidden, Value: #Id#)\r\n                        Div(list-group-item){\r\n                            Div(row mt-sm){\r\n                                Div(col-md-3 mt-sm text-right){\r\n                                    Label(For: Name){\r\n                                        Span(Body: LangRes(lots_name))\r\n                                    }\r\n                                }\r\n                                Div(col-md-9 text-left){\r\n                                    Input(Name: Name, Value: #lot_name#)\r\n                                }\r\n                            }\r\n                            Div(row mt-sm){\r\n                                Div(col-md-3 mt-sm text-right){\r\n                                    Label(For: Description){\r\n                                        Span(Body: LangRes(lots_description))\r\n                                    }\r\n                                }\r\n                                Div(col-md-9 text-left){\r\n                                    Input(Name: Description, Type: textarea, Value: #lot_description#)\r\n                                }\r\n                            }\r\n                            Div(row mt-sm){\r\n                                Div(col-md-3 mt-sm text-right){\r\n                                    Label(For: Photo){\r\n                                        Span(Body: LangRes(Photo))\r\n                                    }\r\n                                }\r\n                                Div(col-md-9 text-left){\r\n                                    Input(Name: Photo, Type: file)\r\n                                }\r\n                            }\r\n                            Div(row mt-sm){\r\n                                Div(col-md-3 mt-sm text-right){\r\n                                    Label(For: LotContract){\r\n                                        Span(Body: LangRes(lots_contract))\r\n                                    }\r\n                                }\r\n                                Div(col-md-9 text-left){\r\n                                    Input(Name: LotContract, Type: file)\r\n                                }\r\n                            }\r\n                        }\r\n                        Div(list-group-item){\r\n                            Div(row mt-sm){\r\n                                Div(col-md-3 mt-sm text-right){\r\n                                    Label(For: DateStart){\r\n                                        Span(Body: LangRes(lots_date_start))\r\n                                    }\r\n                                }\r\n                                Div(col-md-9 text-left){\r\n                                    Input(Name: DateStart, Type: date, Value: #date_start#)\r\n                                }\r\n                            }\r\n                            Div(row mt-sm){\r\n                                Div(col-md-3 mt-sm text-right){\r\n                                    Label(For: DateEnd){\r\n                                        Span(Body: LangRes(lots_date_end))\r\n                                    }\r\n                                }\r\n                                Div(col-md-9 text-left){\r\n                                    Input(Name: DateEnd, Type: date, Value: #date_end#)\r\n                                }\r\n                            }\r\n                        }\r\n                        Div(list-group-item){\r\n                            Div(row mt-sm){\r\n                                Div(col-md-3 mt-sm text-right){\r\n                                    Label(For: AmountStarting){\r\n                                        Span(Body: LangRes(amount_starting))\r\n                                    }\r\n                                }\r\n                                Div(col-md-9 text-left){\r\n                                    Input(Name: AmountStarting, Type: number, Value: #amount_starting#)\r\n                                }\r\n                            }\r\n                            Div(row mt-sm){\r\n                                Div(col-md-3 mt-sm text-right){\r\n                                    Label(For: AmountFinal){\r\n                                        Span(Body: LangRes(amount_final))\r\n                                    }\r\n                                }\r\n                                Div(col-md-9 text-left){\r\n                                    Input(Name: AmountFinal, Type: number, Value: #amount_final#)\r\n                                }\r\n                            }\r\n                            Div(row mt-sm){\r\n                                Div(col-md-3 mt-sm text-right){\r\n                                    Label(For: OrderMin){\r\n                                        Span(Body: LangRes(order_min))\r\n                                    }\r\n                                }\r\n                                Div(col-md-9 text-left){\r\n                                    Input(Name: OrderMin, Type: number, Value: #order_min#)\r\n                                }\r\n                            }\r\n                            Div(row mt-sm){\r\n                                Div(col-md-3 mt-sm text-right){\r\n                                    Label(For: OrderMax){\r\n                                        Span(Body: LangRes(order_max))\r\n                                    }\r\n                                }\r\n                                Div(col-md-9 text-left){\r\n                                    Input(Name: OrderMax, Type: number, Value: #order_max#)\r\n                                }\r\n                            }\r\n\r\n                        }\r\n                    }.Else{\r\n                        Div(list-group-item){\r\n                            Div(row mt-sm){\r\n                                Div(col-md-3 mt-sm text-right){\r\n                                    Label(For: Name){\r\n                                        Span(Body: LangRes(lots_name))\r\n                                    }\r\n                                }\r\n                                Div(col-md-9 text-left){\r\n                                    Input(Name: Name)\r\n                                }\r\n                            }\r\n                            Div(row mt-sm){\r\n                                Div(col-md-3 mt-sm text-right){\r\n                                    Label(For: Description){\r\n                                        Span(Body: LangRes(lots_description))\r\n                                    }\r\n                                }\r\n                                Div(col-md-9 text-left){\r\n                                    Input(Name: Description, Type: textarea)\r\n                                }\r\n                            }\r\n                            Div(row mt-sm){\r\n                                Div(col-md-3 mt-sm text-right){\r\n                                    Label(For: Photo){\r\n                                        Span(Body: LangRes(Photo))\r\n                                    }\r\n                                }\r\n                                Div(col-md-9 text-left){\r\n                                    Input(Name: Photo, Type: file)\r\n                                }\r\n                            }\r\n                            Div(row mt-sm){\r\n                                Div(col-md-3 mt-sm text-right){\r\n                                    Label(For: LotContract){\r\n                                        Span(Body: LangRes(lots_contract))\r\n                                    }\r\n                                }\r\n                                Div(col-md-9 text-left){\r\n                                    Input(Name: LotContract, Type: file)\r\n                                }\r\n                            }\r\n                        }\r\n                        Div(list-group-item){\r\n                            Div(row mt-sm){\r\n                                Div(col-md-3 mt-sm text-right){\r\n                                    Label(For: DateStart){\r\n                                        Span(Body: LangRes(lots_date_start))\r\n                                    }\r\n                                }\r\n                                Div(col-md-9 text-left){\r\n                                    Input(Name: DateStart, Type: date)\r\n                                }\r\n                            }\r\n                            Div(row mt-sm){\r\n                                Div(col-md-3 mt-sm text-right){\r\n                                    Label(For: DateEnd){\r\n                                        Span(Body: LangRes(lots_date_end))\r\n                                    }\r\n                                }\r\n                                Div(col-md-9 text-left){\r\n                                    Input(Name: DateEnd, Type: date)\r\n                                }\r\n                            }\r\n                        }\r\n                        Div(list-group-item){\r\n                            Div(row mt-sm){\r\n                                Div(col-md-3 mt-sm text-right){\r\n                                    Label(For: AmountStarting){\r\n                                        Span(Body: LangRes(amount_starting))\r\n                                    }\r\n                                }\r\n                                Div(col-md-9 text-left){\r\n                                    Input(Name: AmountStarting, Type: number)\r\n                                }\r\n                            }\r\n                            Div(row mt-sm){\r\n                                Div(col-md-3 mt-sm text-right){\r\n                                    Label(For: AmountFinal){\r\n                                        Span(Body: LangRes(amount_final))\r\n                                    }\r\n                                }\r\n                                Div(col-md-9 text-left){\r\n                                    Input(Name: AmountFinal, Type: number)\r\n                                }\r\n                            }\r\n                            Div(row mt-sm){\r\n                                Div(col-md-3 mt-sm text-right){\r\n                                    Label(For: OrderMin){\r\n                                        Span(Body: LangRes(order_min))\r\n                                    }\r\n                                }\r\n                                Div(col-md-9 text-left){\r\n                                    Input(Name: OrderMin, Type: number)\r\n                                }\r\n                            }\r\n                            Div(row mt-sm){\r\n                                Div(col-md-3 mt-sm text-right){\r\n                                    Label(For: OrderMax){\r\n                                        Span(Body: LangRes(order_max))\r\n                                    }\r\n                                }\r\n                                Div(col-md-9 text-left){\r\n                                    Input(Name: OrderMax, Type: number)\r\n                                }\r\n                            }\r\n\r\n                        }\r\n                    }\r\n                }\r\n                Div(panel-footer text-right){\r\n                    If(GetVar(Id)){\r\n                        Button(Body: LangRes(save), Class: btn btn-primary, Contract: lots_Edit, Page: lots_list)\r\n                    }.Else{\r\n                        Button(Body: LangRes(create), Class: btn btn-primary, Contract: lots_Create, Page: lots_list)\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}",
            "Name": "lots_edit",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Conditions": "true",
            "Value": "\r\nDBFind(applications).Columns(\"id\").Where(\"name='Trading Platform' AND deleted=0\").Vars(application)\r\nDBFind(roles).Where(\"id=#role_id#\").Columns(\"role_name\").Vars(r)\r\nSetTitle($lots_list$)\r\nDiv(content-wrapper){\r\n    Div(breadcrumb){\r\n        Span(Class: text-muted, Body: $lots_list$)\r\n    }\r\n\r\n    SetVar(Where,\"deleted=0\")\r\n    If(GetVar(Search)){\r\n        If(GetVar(Status)!=\"\"){\r\n            SetVar(Where,\"#Where# and name='#Search#' and status=#Status#\")\r\n        }.Else{\r\n            SetVar(Where,\"#Where# and name='#Search#'\")\r\n        }\r\n    }.Else{\r\n        If(GetVar(Status)!=\"\"){\r\n            SetVar(Where,\"#Where# and status=#Status#\")\r\n        }\r\n        SetVar(Search,)\r\n    }\r\n\r\n    AddToolButton(Title: $lots_create$, Page: lots_edit, Icon: icon-plus)\r\n    Div(text-right){\r\n        Data(status_icons, \"Icon\"){\r\n            fa fa-hourglass-start\r\n            fa fa-hourglass-half\r\n            fa fa-hourglass-end\r\n            fa fa-check\r\n        }\r\n\r\n        If(GetVar(Status)!=\"\"){\r\n            Button(Class: fa fa-times mr-sm btn bg-danger, Page: lots_list)\r\n        }\r\n        ForList(status_icons){\r\n            SetVar(status,Calculate(#status_icons_index#-1))\r\n            If(#Status#==#status#){\r\n                Button(Class: #Icon# mr-sm btn bg-gray-lighter, Page: lots_list, PageParams: \"Status=#status#,Search=#Search#\")\r\n            }.Else{\r\n                Button(Class: #Icon# mr-sm btn bg-gray, Page: lots_list, PageParams: \"Status=#status#,Search=#Search#\")\r\n            }\r\n        }\r\n    }.Style(div {display:inline-block;})\r\n\r\n    Form(panel panel-primary){\r\n        Div(panel-body){\r\n            Div(row){\r\n                Div(col-md-12){\r\n                    Div(input-group){\r\n                        Div(input-group-addon){\r\n                            LangRes(name)\r\n                        }\r\n                        Input(Name: Search, Value: #Search#)\r\n                        Div(input-group-btn){\r\n                            Button(Class: fa fa-search btn btn-default, Page: lots_list, PageParams: \"Search=Val(Search)\")\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            DBFind(lots, src_lots).Where(\"#Where#\").Count(lots_count).Custom(_name){\r\n                Div(text-left){\r\n                    LinkPage(Class: text-primary h5 text-bold, Page: lots_view, PageParams: \"Id=#id#\", Body: #name#)\r\n                }\r\n            }.Custom(_photo){\r\n                Image(Src: Binary().ById(#photo#), Class:photo)\r\n            }.Custom(_seller){\r\n                Div(text-nowrap){\r\n                    DBFind(members).Columns(\"id,member_name,image_id\").Where(\"id=#seller#\").Vars(seller)\r\n                    If(Or(#seller_id#>0,#seller_id#<0)){\r\n                    }.Else{\r\n                        SetVar(seller_member_name,Address(#seller#))\r\n                    }\r\n                    LinkPage(Class: center text-primary h5 text-bold, Page: profile_view, PageParams: \"v_member_id=#seller#\"){\r\n                        If(#seller_image_id#>0){\r\n                            Image(Src: Binary().ById(#seller_image_id#), Class: img-circle)\r\n                        }.Else{\r\n                            Div(Class: fa icon-user fa-2x mr)\r\n                        }\r\n                        Div(){#seller_member_name#}\r\n                    }\r\n                }\r\n            }.Custom(_date_creation){\r\n                DateTime(#date_creation#, DD.MM.YYYY)\r\n            }.Custom(_date_start){\r\n                DateTime(#date_start#, DD.MM.YYYY)\r\n            }.Custom(_date_end){\r\n                DateTime(#date_end#, DD.MM.YYYY)\r\n            }.Custom(_amount_starting){\r\n                Money(#amount_starting#)\r\n            }.Custom(_amount_final){\r\n                Money(#amount_final#)\r\n            }.Custom(_status){\r\n                SetVar(status_index, Calculate(#status# + 1))\r\n                If(#status_index#==4){\r\n                    SetVar(status_class,text-success)\r\n                }.Else{\r\n                    SetVar(status_class,text-warning)\r\n                }\r\n                Div(#status_class#){\r\n                    AppParam(App: #application_id#, Name: lots_status, Index: #status_index#)\r\n                }\r\n            }.Custom(_actions){\r\n                Div(text-right text-nowrap){\r\n                    If(#status#>0){\r\n                        If(#r_role_name#==\"Buyer\"){\r\n                            Button(Class: btn btn-primary, Body: $lots_bid$, Page: lots_list)\r\n                        }\r\n                    }.Else{\r\n                        If(#r_role_name#==\"Buyer\"){\r\n                            Button(Class: btn btn-primary, Body: $lots_subscribe$, Page: lots_list)\r\n                        }.ElseIf(And(#seller#==#key_id#,#r_role_name#==\"Seller\")){\r\n                            Button(Class: btn btn-default fa fa-edit mr-sm, Page: lots_edit, PageParams: \"Id=#id#\")\r\n                            Button(Class: btn btn-danger fa fa-trash, Page: lots_list, Contract: lots_Delete, Params: \"LotId=#id#\").Alert($lots_delete_auction$, $lots_yes$, $lots_no$)\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            Div(row){\r\n                Div(col-md-12){\r\n                    If(#lots_count#>0){\r\n                        Div(table-responsive){\r\n                            Table(src_lots,\"ID=id,$lots_name$=_name,$photo$=_photo,$seller$=_seller,$date_creation$=_date_creation,$lots_date_start$=_date_start,$lots_date_end$=_date_end,$amount_starting$=_amount_starting,$amount_final$=_amount_final,$lots_status$=_status,=_actions\")\r\n                        }\r\n                    }.Else{\r\n                        Div(text-center h3){\r\n                            LangRes(lots_not_found)\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            If(GetVar(Search)){\r\n                Div(row){\r\n                    Div(col-md-12 mt-lg){\r\n                        Div(text-center){\r\n                            Button(Body: LangRes(show_all), Class: btn btn-primary, Page: lots_list)\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }.Style(\r\n            th,td {text-align:center;}\r\n            .img-circle {height: 30px;width: 30px; border: 1px solid #5A5D63;}\r\n            .center {display:flex; align-items:center;}\r\n            .photo {height: 100px; width: 100px;}\r\n        )\r\n    }\r\n}",
            "Name": "lots_list",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Conditions": "true",
            "Value": "DBFind(applications).Columns(\"id\").Where(\"name='Trading Platform' AND deleted=0\").Vars(application)\r\nDiv(content-wrapper){\r\n    Div(breadcrumb){\r\n        LinkPage($lots_list$, lots_list)\r\n        Span(/,mh)\r\n        Span(Class: text-muted, Body: $lots_view$)\r\n    }\r\n\r\n    If(GetVar(Id)){\r\n        DBFind(lots).Where(\"id=#Id#\").Vars(lot)\r\n        DBFind(roles).Columns(\"role_name\").Where(\"id=#role_id#\").Vars(r)\r\n\r\n        Div(row){\r\n            Div(col-sm-8 col-sm-offset-2 col-lg-6 col-lg-offset-3){\r\n                Form(panel panel-default){\r\n                    Div(panel-heading text-center){\r\n                        If(#lot_deleted#==1){\r\n                            Div(Class: h2 text-danger, Body: LangRes(lot_deleted))\r\n                        }\r\n                        Div(Class: h3, Body: #lot_name#)\r\n                    }\r\n                    Div(panel-body){\r\n                        Div(text-center){\r\n                            Image(Src: Binary().ById(#lot_photo#), Class:big_photo mb-lg)\r\n                        }\r\n                        Div(list-group-item text-center){\r\n                            SetVar(status_index, Calculate(#lot_status# + 1))\r\n                            If(#status_index# == 4){\r\n                                Div(Class: text-success, Body: AppParam(App: #application_id#, Name: lots_status, Index: #status_index#))\r\n                                Div(col-md-6 mt-sm text-right){\r\n                                    LangRes(buyer)\r\n                                }\r\n                                Div(col-md-6 text-left){\r\n                                    DBFind(members).Columns(\"id,member_name,image_id\").Where(\"id=#lot_buyer#\").Vars(buyer)\r\n                                    If(Or(#buyer_id#>0,#buyer_id#<0)){\r\n                                    }.Else{\r\n                                        SetVar(buyer_member_name,Address(#lot_buyer#))\r\n                                    }\r\n                                    LinkPage(Class: center text-primary h5 text-bold, Page: profile_view, PageParams: \"v_member_id=#seller#\"){\r\n                                        If(#buyer_image_id#>0){\r\n                                            Image(Src: Binary().ById(#buyer_image_id#), Class: img-circle mr)\r\n                                        }.Else{\r\n                                            Span(Class: fa icon-user fa-2x mr)\r\n                                        }\r\n                                        Span(#buyer_member_name#)\r\n                                    }\r\n                                }\r\n\r\n                            }.Else{\r\n                                Div(Class: text-warning, Body: AppParam(App: #application_id#, Name: lots_status, Index: #status_index#))\r\n                            }\r\n                        }\r\n                        Div(form-group){\r\n                            Div(list-group-item text-center){\r\n                                Div(row mt-sm t4){\r\n                                    Div(col-md-6 text-right){\r\n                                        ID\r\n                                    }\r\n                                    Div(col-md-6 text-left){\r\n                                        #lot_id#\r\n                                    }\r\n                                }\r\n\r\n                                Div(row mt-sm t4){\r\n                                    Div(col-md-6 text-right){\r\n                                        LangRes(lots_description)\r\n                                    }\r\n                                    Div(col-md-6 text-left){\r\n                                        #lot_description#\r\n                                    }\r\n                                }\r\n\r\n                                Div(row mt-sm t4){\r\n                                    Div(col-md-6 mt-sm text-right){\r\n                                        LangRes(seller)\r\n                                    }\r\n                                    Div(col-md-6 text-left){\r\n                                        DBFind(members).Columns(\"id,member_name,image_id\").Where(\"id=#lot_seller#\").Vars(seller)\r\n                                        If(Or(#seller_id#>0,#seller_id#<0)){\r\n                                        }.Else{\r\n                                            SetVar(seller_member_name,Address(#lot_seller#))\r\n                                        }\r\n                                        LinkPage(Class: center text-primary h5 text-bold, Page: profile_view, PageParams: \"v_member_id=#lot_seller#\"){\r\n                                            If(#seller_image_id#>0){\r\n                                                Image(Src: Binary().ById(#seller_image_id#), Class: img-circle)\r\n                                            }.Else{\r\n                                                Span(Class: fa icon-user fa-2x mr)\r\n                                            }\r\n                                            Span(#seller_member_name#)\r\n                                        }\r\n                                    }\r\n                                }\r\n                            }\r\n\r\n                            Div(list-group-item text-center){\r\n                                Div(row mt-sm t4){\r\n                                    Div(col-md-6 text-right){\r\n                                        LangRes(date_creation)\r\n                                    }\r\n                                    Div(col-md-6 text-left){\r\n                                        DateTime(#lot_date_creation#, DD.MM.YYYY)\r\n                                    }\r\n                                }\r\n                                Div(row mt-sm t4){\r\n                                    Div(col-md-6 text-right){\r\n                                        LangRes(lots_date_start)\r\n                                    }\r\n                                    Div(col-md-6 text-left){\r\n                                        DateTime(#lot_date_start#, DD.MM.YYYY)\r\n                                    }\r\n                                }\r\n                                Div(row mt-sm t4){\r\n                                    Div(col-md-6 text-right){\r\n                                        LangRes(lots_date_end)\r\n                                    }\r\n                                    Div(col-md-6 text-left){\r\n                                        DateTime(#lot_date_end#, DD.MM.YYYY)\r\n                                    }\r\n                                }\r\n                            }\r\n\r\n                            Div(list-group-item text-center){\r\n                                Div(row mt-sm t4){\r\n                                    Div(col-md-6 text-right){\r\n                                        LangRes(amount_starting)\r\n                                    }\r\n                                    Div(col-md-6 text-left){\r\n                                        Money(#lot_amount_starting#)\r\n                                    }\r\n                                }\r\n\r\n                                Div(row mt-sm t4){\r\n                                    Div(col-md-6 text-right){\r\n                                        LangRes(amount_final)\r\n                                    }\r\n                                    Div(col-md-6 text-left){\r\n                                        Money(#lot_amount_final#)\r\n                                    }\r\n                                }\r\n\r\n                                Div(row mt-sm t4){\r\n                                    Div(col-md-6 text-right){\r\n                                        LangRes(order_min)\r\n                                    }\r\n                                    Div(col-md-6 text-left){\r\n                                        Money(#lot_order_min#)\r\n                                    }\r\n                                }\r\n\r\n                                Div(row mt-sm t4){\r\n                                    Div(col-md-6 text-right){\r\n                                        LangRes(order_max)\r\n                                    }\r\n                                    Div(col-md-6 text-left){\r\n                                        Money(#lot_order_max#)\r\n                                    }\r\n                                }\r\n\r\n                                Div(row mt-sm t4){\r\n                                    Div(col-md-6 text-right){\r\n                                        LangRes(lots_amount_max)\r\n                                    }\r\n                                    Div(col-md-6 text-left){\r\n                                        Money(#lot_amount_max#)\r\n                                    }\r\n                                }\r\n                            }\r\n\r\n                            Div(list-group-item text-center){\r\n                                Div(row mt-sm t4){\r\n                                    Div(col-md-12){\r\n                                        DBFind(binaries, src_binaries).Where(\"id=#lot_contract_id#\")\r\n                                        Table(Source: src_binaries, \"$lots_contract$=data\")\r\n                                    }\r\n                                }\r\n                            }\r\n                            If(#lot_deleted#==0) {\r\n                                If(#r_role_name#==\"Buyer\"){\r\n                                    Div(list-group-item text-center){\r\n                                        If(#lot_status#==0){\r\n                                            Button(Class: btn btn-primary btn-block, Body: $lots_subscribe$, Page: lots_list)\r\n                                        }.Else{\r\n                                            Button(Class: btn btn-primary btn-block, Body: $lots_bid$, Page: lots_list)\r\n                                        }\r\n                                    }\r\n                                }.ElseIf(#r_role_name#==\"Seller\"){\r\n                                    If(And(#lot_seller#==#key_id#,#lot_status#==0)){\r\n                                        Div(list-group-item text-center){\r\n                                            Button(Class: btn btn-default btn-block, Body: LangRes(lot_edit), Page: lots_edit, PageParams: \"Id=#Id#\")\r\n                                        }\r\n                                        Div(list-group-item text-center){\r\n                                            Button(Class: btn btn-danger btn-block, Body: LangRes(lots_delete), Page: lots_list, Contract: lots_Delete, Params: \"LotId=#Id#\").Alert($lots_delete_auction$, $lots_yes$, $lots_no$)\r\n                                        }\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}.Style(\r\n    th,td {text-align:center;}\r\n    .t4 {font-size:18px;}\r\n    .img-circle {height: 30px;width: 30px; border: 1px solid #5A5D63;}\r\n    .center {display:flex; align-items:center;}\r\n    .big_photo {height: 300px; width: 300px;}\r\n)",
            "Name": "lots_view",
            "Menu": "default_menu",
            "Type": "pages"
        },
        {
            "Conditions": "true",
            "Value": "contract lots_Create {\r\n    data {\r\n        Name string\r\n        Description string\r\n        Photo bytes \"file\"\r\n        LotContract bytes \"file\"\r\n        DateStart string \"date\"\r\n        DateEnd string \"date\"\r\n        AmountStarting money\r\n        AmountFinal money\r\n        OrderMin money\r\n        OrderMax money\r\n\r\n    }\r\n\r\n    conditions {\r\n        RoleConditions(\"role\", \"Seller\")\r\n        if $OrderMin > $OrderMax {\r\n            warning \"Minimum order bigger than maximum order\"\r\n        }\r\n    }\r\n\r\n    action {\r\n        var appId imageId contractFileId int\r\n        appId = Int(DBFind(\"applications\").Where(\"name=? AND deleted=0\", \"Trading Platform\").One(\"id\"))\r\n\r\n        imageId = @1UploadBinary(\"ApplicationId,Name,Data\", appId, \"lot_photo\", $Photo)\r\n        contractFileId = @1UploadBinary(\"ApplicationId,Name,Data,DataMimeType\", appId, \"lot_contract\", $LotContract, \"application/pdf\")\r\n\r\n\r\n        DBInsert(\"lots\", \"name,description,photo,timestamp date_creation,date_start,date_end,amount_starting,amount_final,seller,order_min,order_max,contract_id\", $Name, $Description, imageId, $block_time, $DateStart, $DateEnd, $AmountStarting, $AmountFinal, $key_id, $OrderMin, $OrderMax, contractFileId)\r\n\r\n    }\r\n}",
            "Name": "lots_Create",
            "Type": "contracts"
        },
        {
            "Conditions": "true",
            "Value": "contract lots_Delete {\r\n    data {\r\n        LotId int\r\n    }\r\n\r\n    conditions {\r\n        var lot map\r\n        lot = DBFind(\"lots\").Where(\"id=?\", $LotId).Row()\r\n\r\n        if !lot {\r\n            warning \"Lot not found\"\r\n        }\r\n        if lot[\"status\"] > 0 {\r\n            warning \"Bidding has already begun\"\r\n        }\r\n    }\r\n\r\n    action {\r\n        DBUpdate(\"lots\", $LotId, \"deleted\", 1)\r\n    }\r\n}",
            "Name": "lots_Delete",
            "Type": "contracts"
        },
        {
            "Conditions": "true",
            "Value": "contract lots_Edit {\r\n    data {\r\n        Id int\r\n        Name string\r\n        Description string\r\n        Photo bytes \"file\"\r\n        LotContract bytes \"file\"\r\n        DateStart string\r\n        DateEnd string\r\n        AmountStarting money\r\n        AmountFinal money\r\n        OrderMin money\r\n        OrderMax money\r\n    }\r\n\r\n    conditions {\r\n        var lot map\r\n        lot = DBFind(\"lots\").Where(\"id=?\", $Id).Row()\r\n\r\n        if !lot {\r\n            warning \"Lot not found\"\r\n        }\r\n        if lot[\"deleted\"] > 0 {\r\n            warning \"Lot deleted\"\r\n        }\r\n\r\n        if lot[\"status\"] > 0 {\r\n            warning \"Bidding has already begun\"\r\n        }\r\n\r\n        if lot[\"seller\"] != $key_id {\r\n            warning \"You are not seller of the lot\"\r\n        }\r\n    }\r\n\r\n    action {\r\n        var appId imageId contractFileId int\r\n        appId = Int(DBFind(\"applications\").Where(\"name = $ AND deleted = 0\", \"Trading Platform\").One(\"id\"))\r\n        imageId = @1UploadBinary(\"ApplicationId,Name,Data\", appId, \"lot_photo\", $Photo)\r\n        contractFileId = @1UploadBinary(\"ApplicationId,Name,Data,DataMimeType\", appId, \"lot_contract\", $LotContract, \"application/pdf\")\r\n\r\n        DBUpdate(\"lots\", $Id, \"name,description,photo,date_start,date_end,amount_starting,amount_final,order_min,order_max,contract_id\", $Name, $Description, imageId, $DateStart, $DateEnd, $AmountStarting, $AmountFinal, $OrderMin, $OrderMax, contractFileId)\r\n    }\r\n}",
            "Name": "lots_Edit",
            "Type": "contracts"
        }
    ]
}